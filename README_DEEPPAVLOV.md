# Сервис анонимизации на DeepPavlov

## Описание

Переписанная версия `main.py` использует DeepPavlov NER модель вместо Presidio для более точного распознавания именованных сущностей на русском языке.

## Установка

### 1. Установите зависимости

```bash
pip install -r requirements.txt
```

### 2. Установите модель NER

```bash
python -m deeppavlov install ner_rus_bert
```

Или через pip:

```bash
pip install deeppavlov[torch]
```

## Запуск

```bash
python main.py
```

или

```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```

При первом запуске модель автоматически загрузится.

## API

API полностью совместимо с предыдущей версией:

### POST /anonymize

```bash
curl -X POST http://localhost:8000/anonymize \
  -H "Content-Type: application/json" \
  -d '{"text": "Иван Иванов, телефон +79001234567, адрес: северный пр 69"}'
```

### GET /health

Проверка состояния сервиса и загруженной модели.

## Особенности

1. **Использует DeepPavlov ner_rus_bert** - специализированная модель для русского NER
2. **Комбинированный подход** - DeepPavlov для имен и локаций + паттерны для телефонов, ИНН, паспортов и адресов
3. **Улучшенная обработка адресов** - все паттерны сохранены и работают
4. **Очистка имен** - функция `clean_name_text` предотвращает захват стоп-слов

## Преимущества DeepPavlov

- Лучшая точность для русского языка
- Оптимизирована для русских текстов
- Хорошо работает с именами и локациями
- Легко расширяется

## Устранение неполадок

Если модель не загружается:

1. Проверьте установку:
   ```bash
   python -m deeppavlov install ner_rus_bert
   ```

2. Проверьте наличие torch:
   ```bash
   pip install torch
   ```

3. Проверьте логи при запуске сервера

## Миграция с Presidio

Для перехода с Presidio на DeepPavlov:

1. Остановите старый сервер
2. Установите DeepPavlov: `pip install deeppavlov[torch]`
3. Установите модель: `python -m deeppavlov install ner_rus_bert`
4. Перезапустите сервер

API полностью совместимо, изменения в клиентском коде не требуются.

